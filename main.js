(()=>{"use strict";function t(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function e(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function n(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function r(t,e,r){return e&&n(t.prototype,e),r&&n(t,r),Object.defineProperty(t,"prototype",{writable:!1}),t}function o(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var i=function(){function t(n,r,i,s,u,a){e(this,t),o(this,"_templateSelector",void 0),o(this,"_cardElement",void 0),o(this,"_cardId",void 0),o(this,"_myId",void 0),o(this,"_likes",void 0),o(this,"_ownerId",void 0),o(this,"_isMyOwnCard",void 0),o(this,"_handleCardClick",void 0),o(this,"_handleOpenPopupConfirm",void 0),o(this,"_handleCardLike",void 0),o(this,"_elementTitle",void 0),o(this,"_elementImage",void 0),o(this,"_elementLikeButton",void 0),o(this,"_counterLikes",void 0),o(this,"_elementDeleteButton",void 0),this._imgSrc=n.link,this._name=n.name,this._likes=n.likes,this._myId=r,this._ownerId=n.owner._id,this.cardId=n._id,this._isMyOwnCard=this._myId===this._ownerId,this._templateSelector=i,this._handleCardClick=s,this._handleOpenPopupConfirm=u,this._handleCardLike=a}return r(t,[{key:"generateCard",value:function(){var t=this;return this._cardElement=this._getTemplate(),this._elementImage=this._cardElement.querySelector(".element__image"),this._elementTitle=this._cardElement.querySelector(".element__title"),this._elementLikeButton=this._cardElement.querySelector(".element__like-button"),this._counterLikes=this._cardElement.querySelector(".element__counter-likes"),this._elementDeleteButton=this._cardElement.querySelector(".element__delete-button"),this._elementImage.src=this._imgSrc,this._elementImage.alt="Фотография: ".concat(this._name),this._elementTitle.textContent=this._name,this.myLike=this._likes.some((function(e){return e._id===t._myId})),this._counterLikes.textContent=this._likes.length,this.myLike&&this._elementLikeButton.classList.add("element__like-button_active"),this._setEventListeners(),this._cardElement}},{key:"_getTemplate",value:function(){return document.querySelector(this._templateSelector).content.querySelector(".element").cloneNode(!0)}},{key:"likeHandler",value:function(t){this._elementLikeButton.classList.add("element__like-button_active"),this._counterLikes.textContent=t,this.myLike=!0}},{key:"dislikeHandler",value:function(t){this._elementLikeButton.classList.remove("element__like-button_active"),this._counterLikes.textContent=t,this.myLike=!1}},{key:"removeHandler",value:function(){this._cardElement.remove(),this._cardElement=null}},{key:"_setEventListeners",value:function(){var t=this;this._elementImage.addEventListener("click",(function(){t._handleCardClick(t)})),this._elementLikeButton.addEventListener("click",(function(){t._handleCardLike(t)})),this._isMyOwnCard?this._elementDeleteButton.addEventListener("click",(function(){t._handleOpenPopupConfirm(t)})):(this._elementDeleteButton.remove(),this._elementDeleteButton=null)}}]),t}(),s=function(){function t(n,r){e(this,t),o(this,"_inputSelector",void 0),o(this,"_saveButtonSelector",void 0),o(this,"_inactiveButtonClass",void 0),o(this,"_errorClass",void 0),o(this,"_classForm",void 0),o(this,"_inputList",void 0),o(this,"_errorList",void 0),o(this,"_saveButton",void 0),o(this,"_formError",void 0),this._inputSelector=n.inputSelector,this._saveButtonSelector=n.saveButtonSelector,this._inactiveButtonClass=n.inactiveButtonClass,this._errorClass=n.inputErrorClass,this._formError=n.formError,this._classForm=r,this._inputList=Array.from(this._classForm.querySelectorAll(this._inputSelector)),this._saveButton=this._classForm.querySelector(this._saveButtonSelector)}return r(t,[{key:"_disableSubmitButton",value:function(){this._saveButton.setAttribute("disabled",!0),this._saveButton.classList.add(this._inactiveButtonClass)}},{key:"_restartError",value:function(){var t=this;this._inputList.forEach((function(e){var n=t._classForm.querySelector(".form__input-".concat(e.id,"-error"));t._hideError(e,n)}))}},{key:"resetValidation",value:function(){this._saveButton&&(this._disableSubmitButton(),this._restartError())}},{key:"_showError",value:function(t,e){t.classList.add(this._errorClass),e.textContent=t.validationMessage}},{key:"_hideError",value:function(t,e){t.classList.remove(this._errorClass),e.textContent=""}},{key:"_toggleInputError",value:function(t){var e=this._classForm.querySelector(".form__input-".concat(t.id,"-error"));e&&(t.validity.valid?this._hideError(t,e):this._showError(t,e))}},{key:"_checkInputValidity",value:function(){for(var t=0;t<this._inputList.length;t++)if(!this._inputList[t].validity.valid)return!1;return!0}},{key:"_toggleSaveButtonStatus",value:function(){this._checkInputValidity()?(this._saveButton.disabled=!1,this._saveButton.classList.remove(this._inactiveButtonClass)):this._disableSubmitButton()}},{key:"_connectAllEventListeners",value:function(){var t=this;this._inputList.forEach((function(e){e.addEventListener("input",(function(){t._toggleInputError(e),t._toggleSaveButtonStatus()}))}))}},{key:"enableValidation",value:function(){this._connectAllEventListeners()}}]),t}(),u=function(){function t(n,r,i){e(this,t),o(this,"_items",void 0),o(this,"_renderer",void 0),o(this,"_container",void 0),this._items=n,this._renderer=r,this._container=document.querySelector(i)}return r(t,[{key:"renderItems",value:function(){var t=this;this._items.forEach((function(e){return t.addItem(e)}))}},{key:"addItem",value:function(t){if(t){var e=this._renderer(t);this._container.prepend(e)}}}]),t}();function a(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function c(t){return c=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},c(t)}function l(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=c(t)););return t}function h(){return h="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,n){var r=l(t,e);if(r){var o=Object.getOwnPropertyDescriptor(r,e);return o.get?o.get.call(arguments.length<3?t:n):o.value}},h.apply(this,arguments)}function d(t,e){return d=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},d(t,e)}function _(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&d(t,e)}function f(t){return f="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},f(t)}function p(t,e){if(e&&("object"===f(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return a(t)}var m=function(){function t(n){e(this,t),this.popup=document.querySelector(n),this.handleEscClose=this._handleEscClose.bind(this)}return r(t,[{key:"_handleEscClose",value:function(t){"Escape"===t.key&&this.close()}},{key:"setEventListeners",value:function(){var t=this;this.popup.addEventListener("click",(function(e){(e.target.classList.contains("popup_opened")||e.target.classList.contains("popup__close-button"))&&t.close()}))}},{key:"open",value:function(){this.popup.classList.add("popup_opened"),document.addEventListener("keydown",this.handleEscClose)}},{key:"close",value:function(){this.popup.classList.remove("popup_opened"),document.removeEventListener("keydown",this.handleEscClose)}}]),t}();var v=function(t){_(u,t);var n,i,s=(n=u,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=c(n);if(i){var r=c(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return p(this,t)});function u(t){var n;return e(this,u),o(a(n=s.call(this,t)),"_popupImageLink",void 0),o(a(n),"_popupImageTitle",void 0),n._popupImageLink=n.popup.querySelector(".popup__pictures"),n._popupImageTitle=n.popup.querySelector(".popup__pictures-title"),n}return r(u,[{key:"open",value:function(t){var e=Object.assign({},(function(t){if(null==t)throw new TypeError("Cannot destructure "+t)}(t),t));this._popupImageLink.src=e._imgSrc,this._popupImageLink.alt=e._name,this._popupImageTitle.textContent=e._name,h(c(u.prototype),"open",this).call(this)}}]),u}(m);var y=function(t){_(u,t);var n,i,s=(n=u,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=c(n);if(i){var r=c(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return p(this,t)});function u(t,n){var r;return e(this,u),o(a(r=s.call(this,t)),"_popupForm",void 0),o(a(r),"_inputList",void 0),o(a(r),"_handleFormSubmit",void 0),o(a(r),"_formValues",void 0),o(a(r),"_buttonSubmit",void 0),o(a(r),"_defaultBtnName",void 0),r._popupForm=r.popup.querySelector(".form"),r._inputList=r._popupForm.querySelectorAll(".form__input"),r._handleFormSubmit=n,r._buttonSubmit=r._popupForm.querySelector(".form__save-button"),r._defaultBtnName=r._buttonSubmit.textContent,r}return r(u,[{key:"getInputValues",value:function(){var t=this;return this._formValues={},this._inputList.forEach((function(e){t._formValues[e.name]=e.value})),this._formValues}},{key:"setEventListeners",value:function(){var t=this;h(c(u.prototype),"setEventListeners",this).call(this),this.popup.addEventListener("submit",(function(e){e.preventDefault(),t._handleFormSubmit(t.getInputValues())}))}},{key:"close",value:function(){h(c(u.prototype),"close",this).call(this),this._popupForm.reset()}},{key:"renderLoader",value:function(t){this._buttonSubmit.textContent=t?"Loading...":this._defaultBtnName}}]),u}(m),b=function(){function t(n){var r=n.name,i=n.about,s=n.avatar;e(this,t),o(this,"_name",void 0),o(this,"_work",void 0),o(this,"_avatar",void 0),o(this,"_id",void 0),this._name=document.querySelector(r),this._work=document.querySelector(i),this._avatar=document.querySelector(s)}return r(t,[{key:"getUserInfo",value:function(){return{name:this._name.textContent,about:this._work.textContent}}},{key:"setUserInfo",value:function(t){this._name.textContent=t.name,this._work.textContent=t.about,this._avatar.src=t.avatar,this._id=t._id}},{key:"getUserId",value:function(){return this._id}}]),t}(),k=function(){function t(n){var r=n.baseUrl,i=n.options;e(this,t),o(this,"_baseUrl",void 0),o(this,"_options",void 0),this._baseUrl=r,this._options=i}return r(t,[{key:"_checkResponse",value:function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))}},{key:"getAddingPictures",value:function(){var t=this;return fetch("".concat(this._baseUrl,"/cards"),{headers:this._options}).then((function(e){return t._checkResponse(e)}))}},{key:"addItem",value:function(t){var e=this,n=t.name,r=t.link;return fetch("".concat(this._baseUrl,"/cards"),{method:"POST",headers:this._options,body:JSON.stringify({name:"".concat(n),link:"".concat(r)})}).then((function(t){return e._checkResponse(t)}))}},{key:"removeItem",value:function(t){var e=this;return fetch("".concat(this._baseUrl,"/cards/").concat(t),{method:"DELETE",headers:this._options}).then((function(t){return e._checkResponse(t)}))}},{key:"likeItem",value:function(t){var e=this;return fetch("".concat(this._baseUrl,"/cards/").concat(t,"/likes"),{method:"PUT",headers:this._options}).then((function(t){return e._checkResponse(t)}))}},{key:"dislikeItem",value:function(t){var e=this;return fetch("".concat(this._baseUrl,"/cards/").concat(t,"/likes"),{method:"DELETE",headers:this._options}).then((function(t){return e._checkResponse(t)}))}},{key:"getUserInfo",value:function(){var t=this;return fetch("".concat(this._baseUrl,"/users/me"),{headers:this._options}).then((function(e){return t._checkResponse(e)}))}},{key:"updateUserInfo",value:function(t){var e=this,n=t.name,r=t.about;return fetch("".concat(this._baseUrl,"/users/me"),{method:"PATCH",headers:this._options,body:JSON.stringify({name:"".concat(n),about:"".concat(r)})}).then((function(t){return e._checkResponse(t)}))}},{key:"updateUserAvatar",value:function(t){var e=this,n=t.avatar;return fetch("".concat(this._baseUrl,"/users/me/avatar"),{method:"PATCH",headers:this._options,body:JSON.stringify({avatar:"".concat(n)})}).then((function(t){return e._checkResponse(t)}))}}]),t}();var S,L=function(t){_(u,t);var n,i,s=(n=u,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=c(n);if(i){var r=c(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return p(this,t)});function u(t,n){var r;return e(this,u),o(a(r=s.call(this,t)),"_popupForm",void 0),o(a(r),"_handleFormSubmit",void 0),o(a(r),"_item",void 0),o(a(r),"_buttonSubmit",void 0),o(a(r),"_defaultBtnName",void 0),r._popupForm=r.popup.querySelector(".form"),r._handleFormSubmit=n,r._buttonSubmit=r._popupForm.querySelector(".form__save-button"),r._defaultBtnName=r._buttonSubmit.textContent,r}return r(u,[{key:"open",value:function(t){h(c(u.prototype),"open",this).call(this),this._item=t}},{key:"setEventListeners",value:function(){var t=this;h(c(u.prototype),"setEventListeners",this).call(this),this.popup.addEventListener("submit",(function(e){e.preventDefault(),t._handleFormSubmit(t._item)}))}},{key:"renderLoader",value:function(t){this._buttonSubmit.textContent=t?"Deleting...":this._defaultBtnName}}]),u}(m),g={formSelector:".form",inputSelector:".form__input",saveButtonSelector:".form__save-button",inactiveButtonClass:"form__save-button_disabled",inputErrorClass:"form__input_type_error",formError:".form__error"},E=(document.getElementById("popup-profile"),document.querySelector(".profile__edit-button")),I=document.querySelector(".form__input_type_name"),C=document.querySelector(".form__input_type_about"),w=document.querySelector(".profile__avatar-btn"),B=(document.querySelector(".popup_change-avatar"),document.querySelector(".form_change-avatar")),q=(document.getElementById("popup-action"),document.querySelector(".form_profile")),O=document.querySelector(".form_card"),R=document.querySelector(".profile__add-button"),U=(document.querySelector('[name="add__profile"]'),document.querySelector(".popup__pictures-title"),document.querySelector(".popup__pictures"),new k({baseUrl:"https://mesto.nomoreparties.co/v1/cohort-52",options:{authorization:"4d3c9e1d-cc98-4110-97fa-b50511b9880a","Content-Type":"application/json"}})),P=new v("#pictures-popup");P.setEventListeners();var j=new b({name:".profile__name",about:".profile__about",avatar:".profile__avatar"}),x=new L("#popup-delItem",(function(t){x.renderLoader(!0),U.removeItem(t.cardId).then((function(){t.removeHandler(),x.close()})).catch((function(t){return console.error(t)})).finally((function(){return x.renderLoader(!1)}))}));x.setEventListeners();var F=new y("#popup-action",(function(t){F.renderLoader(!0),U.addItem(t).then((function(t){S.addItem(t),F.close()})).catch((function(t){return console.error(t)})).finally((function(){return F.renderLoader(!1)}))}));F.setEventListeners();var T=new y("#popup-profile",(function(t){T.renderLoader(!0),U.updateUserInfo({name:t.name,about:t.about}).then((function(t){j.setUserInfo(t),T.close()})).catch((function(t){return console.error(t)})).finally((function(){return T.renderLoader(!1)}))}));T.setEventListeners();var A=new y(".popup_change-avatar",(function(t){A.renderLoader(!0),U.updateUserAvatar(t).then((function(t){j.setUserInfo(t),A.close()})).catch((function(){return alert("Пожалуйста, укажите ссылку на картинку")})).finally((function(){return A.renderLoader(!1)}))}));A.setEventListeners();var V=new s(g,q);V.enableValidation();var D=new s(g,O);D.enableValidation();var N=new s(g,B);N.enableValidation(),E.addEventListener("click",(function(){T.open();var t=j.getUserInfo();I.value=t.name,C.value=t.about,V.resetValidation()})),R.addEventListener("click",(function(){F.open(),D.resetValidation()})),w.addEventListener("click",(function(){A.open(),N.resetValidation()}));var H=function(t){P.open(t)},M=function(t){x.open(t)},J=function(t){t.myLike?U.dislikeItem(t.cardId).then((function(e){t.dislikeHandler(e.likes.length)})).catch((function(t){return console.error(t)})):U.likeItem(t.cardId).then((function(e){t.likeHandler(e.likes.length)})).catch((function(t){return console.error(t)}))};Promise.all([U.getUserInfo(),U.getAddingPictures()]).then((function(e){var n,r,o=(r=2,function(t){if(Array.isArray(t))return t}(n=e)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var r,o,i=[],s=!0,u=!1;try{for(n=n.call(t);!(s=(r=n.next()).done)&&(i.push(r.value),!e||i.length!==e);s=!0);}catch(t){u=!0,o=t}finally{try{s||null==n.return||n.return()}finally{if(u)throw o}}return i}}(n,r)||function(e,n){if(e){if("string"==typeof e)return t(e,n);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?t(e,n):void 0}}(n,r)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),s=o[0],a=o[1];j.setUserInfo({name:s.name,about:s.about,avatar:s.avatar,_id:s._id}),(S=new u(a,(function(t){return new i(t,j.getUserId(),".element__template",H,M,J).generateCard()}),".elements-wrapper")).renderItems()})).catch((function(t){return console.error("Ошибка: ".concat(t))}))})();